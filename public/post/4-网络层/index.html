<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='概念 网络层功能 网络层的任务是将源计算机发出的数据分组（数据报）经过适当的路径送到目的地计算机，从源端到目的端可能要经过若干中间节点。 网络层是'>
<title>4 网络层 | Bethel's Blog</title>

<link rel='canonical' href='http://localhost:1313/post/4-%E7%BD%91%E7%BB%9C%E5%B1%82/'>

<link rel="stylesheet" href="/scss/style.min.c3c7ecff622b4ad3ac6aacf17244c017cc674f0e82b470bfb8f4de85243313d0.css"><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"K3aYNEt3ZeYoZwhE",ck:"K3aYNEt3ZeYoZwhE"})</script>
<script async src="https://umami.xalaok.top/uanalytics" data-website-id="095ee454-e560-4d9b-bf1c-869f8529c17f"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//instant.page/5.2.0" type="module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script><meta property='og:title' content='4 网络层'>
<meta property='og:description' content='概念 网络层功能 网络层的任务是将源计算机发出的数据分组（数据报）经过适当的路径送到目的地计算机，从源端到目的端可能要经过若干中间节点。 网络层是'>
<meta property='og:url' content='http://localhost:1313/post/4-%E7%BD%91%E7%BB%9C%E5%B1%82/'>
<meta property='og:site_name' content='Bethel'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-01-23T20:36:56&#43;00:00'/><meta property='article:modified_time' content='2024-01-23T20:36:56&#43;00:00'/>
<meta name="twitter:title" content="4 网络层">
<meta name="twitter:description" content="概念 网络层功能 网络层的任务是将源计算机发出的数据分组（数据报）经过适当的路径送到目的地计算机，从源端到目的端可能要经过若干中间节点。 网络层是">
    <link rel="shortcut icon" href="/favicon.png" />
<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaigbscreen.css" />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/tx_hu92c04046da3d4074953cad185e3935e5_62559_300x0_resize_q75_box.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Bethel</a></h1>
            <h2 class="site-description">Live and learn. ✍️</h2>
        </div>
    </header><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>首页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="http://localhost:1313/" selected></option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun-high" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z" />
  <path d="M6.343 17.657l-1.414 1.414" />
  <path d="M6.343 6.343l-1.414 -1.414" />
  <path d="M17.657 6.343l1.414 -1.414" />
  <path d="M17.657 17.657l1.414 1.414" />
  <path d="M4 12h-2" />
  <path d="M12 4v-2" />
  <path d="M20 12h2" />
  <path d="M12 20v2" />
</svg>
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon-stars" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
  <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2" />
  <path d="M19 11h2m-1 -1v2" />
</svg>
                    <span>深色模式</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#概念">概念</a>
      <ol>
        <li><a href="#网络层功能">网络层功能</a></li>
        <li><a href="#存储转发分组交换机制">存储转发分组交换机制</a></li>
        <li><a href="#向传输层提供的服务虚电路和数据表">向传输层提供的服务：虚电路和数据表</a></li>
      </ol>
    </li>
    <li><a href="#路由选择算法">路由选择算法</a>
      <ol>
        <li><a href="#最优化原则">最优化原则</a></li>
        <li><a href="#最短路径选择算法dijkstra-最短路由搜索算法">最短路径选择算法（Dijkstra 最短路由搜索算法）</a></li>
        <li><a href="#扩散算法flooding洪泛">扩散算法（Flooding）洪泛</a></li>
        <li><a href="#距离矢量路由选择distance-vector-routing">距离矢量路由选择（Distance Vector Routing）</a></li>
        <li><a href="#链路状态路由选择link-state-routing">链路状态路由选择（Link State Routing）</a></li>
        <li><a href="#层次路由hierarchical-routing">层次路由（Hierarchical Routing）</a></li>
        <li><a href="#dvr-和-lsr-对比">DVR 和 LSR 对比</a></li>
      </ol>
    </li>
    <li><a href="#拥塞控制">拥塞控制</a></li>
    <li><a href="#服务质量">服务质量</a></li>
    <li><a href="#网络互联">网络互联</a></li>
    <li><a href="#internet上的网络层">Internet上的网络层</a>
      <ol>
        <li><a href="#ipv4">IPv4</a>
          <ol>
            <li><a href="#ipv4-header">IPv4 Header</a></li>
            <li><a href="#例ip-数据报分段">例：IP 数据报分段</a></li>
            <li><a href="#严格源路由">严格源路由</a></li>
            <li><a href="#松散源路由">松散源路由</a></li>
            <li><a href="#记录路由">记录路由</a></li>
            <li><a href="#时间戳">时间戳</a></li>
            <li><a href="#ipv4-地址">IPv4 地址</a></li>
            <li><a href="#ipv4-地址的应用规划">IPv4 地址的应用规划</a></li>
            <li><a href="#nat转换">NAT转换</a></li>
            <li><a href="#ip-数据报分组和转发过程">IP 数据报分组和转发过程</a></li>
          </ol>
        </li>
        <li><a href="#ipv6">IPv6</a></li>
        <li><a href="#其他协议">其他协议</a>
          <ol>
            <li><a href="#icmp">ICMP</a></li>
            <li><a href="#arp">ARP</a></li>
            <li><a href="#dhcp">DHCP</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="background-color: #2a9d8f; color: #fff;">
                计算机网络
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/post/4-%E7%BD%91%E7%BB%9C%E5%B1%82/">4 网络层</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-01-23</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 19 分钟
                </time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
  <path d="M13.5 6.5l4 4" />
</svg>
                <time class="article-words">
                    字数: 9230 字
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="概念">概念<a hidden class="anchor" aria-hidden="true" href="#概念">#</a></h2>
<h3 id="网络层功能">网络层功能<a hidden class="anchor" aria-hidden="true" href="#网络层功能">#</a></h3>
<p>网络层的任务是将源计算机发出的数据分组（数据报）经过适当的路径送到目的地计算机，从源端到目的端可能要经过若干中间节点。</p>
<p>网络层是处理计算机网络中<strong>端到端数据传输的最低层</strong>。</p>
<h3 id="存储转发分组交换机制">存储转发分组交换机制<a hidden class="anchor" aria-hidden="true" href="#存储转发分组交换机制">#</a></h3>
<p>一台主机要发送一个分组（数据报），那么它将分组传送给最近的路由器，该路由器或者在它自己的 LAN 上，或者在一条通向承运商的点到点链路上。该分组被存储在路由器上，一直到它完全到达路由器为止，所以路由器可以验证它的校验和。然后它被沿路转发到下一台路由器，直到到达目标主机为止，最后在目标主机上它被递交给相应的进程。</p>
<blockquote>
<p><strong>网络层****传输的单位：分组</strong></p>
</blockquote>
<h3 id="向传输层提供的服务虚电路和数据表">向传输层提供的服务：虚电路和数据表<a hidden class="anchor" aria-hidden="true" href="#向传输层提供的服务虚电路和数据表">#</a></h3>
<p>分组交换</p>
<ol>
<li>面向连接的虚电路服务 （Virtual Circuit approach）</li>
</ol>
<p><strong>发送方</strong>发送给<strong>接收方</strong>的所有分组都沿着同一条虚电路传送</p>
<p>不是真正的物理连接</p>
<p>Virtual Circuit Identidier（VIC）:标识虚电路的信号，要先建立虚连接</p>
<ol>
<li>无连接的数据报服务（Datagram approach）</li>
</ol>
<p><strong>发送方<strong><strong>发送给</strong></strong>接收方****的分组可能沿着不同路径传送</strong></p>
<p>无连接，每个包单独处理，没有真正的带宽分配</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>对比的方面</th>
<th>虚电路</th>
<th>数据报</th>
</tr>
</thead>
<tbody>
<tr>
<td>连接的建立</td>
<td>必须有</td>
<td>不要</td>
</tr>
<tr>
<td>目的站地址</td>
<td>仅在连接建立阶段使用，每个分组使用短的虚电路号</td>
<td>每个分组都有目的站的全地址</td>
</tr>
<tr>
<td>路由选择</td>
<td>在虚电路连接建立时进行，所有分组均按同一路由</td>
<td>每个分组独立选择路由</td>
</tr>
<tr>
<td>当路由器出故障</td>
<td>所有通过了出故障的路由器的虚电路均不能工作</td>
<td>出故障的路由器可能会丢失分组，一些路由可能会发生变化</td>
</tr>
<tr>
<td>分组的顺序</td>
<td>总是按发送顺序到达目的站</td>
<td>到达目的站时可能不按发送顺序</td>
</tr>
<tr>
<td>端到端的差错处理</td>
<td>由通信子网负责</td>
<td>由主机负责</td>
</tr>
<tr>
<td>端到端的流量控制</td>
<td>由通信子网负责</td>
<td>由主机负责</td>
</tr>
</tbody>
</table></div>
<h2 id="路由选择算法">路由选择算法<a hidden class="anchor" aria-hidden="true" href="#路由选择算法">#</a></h2>
<h3 id="最优化原则">最优化原则<a hidden class="anchor" aria-hidden="true" href="#最优化原则">#</a></h3>
<p>如果路由器 J 是在从路由器 I 到路由器 K 的最优路径上，那么，从 J 到 K 的最优路径也必定沿着同样的路由路径。</p>
<h3 id="最短路径选择算法dijkstra-最短路由搜索算法">最短路径选择算法（Dijkstra 最短路由搜索算法）<a hidden class="anchor" aria-hidden="true" href="#最短路径选择算法dijkstra-最短路由搜索算法">#</a></h3>
<h3 id="扩散算法flooding洪泛">扩散算法（Flooding）洪泛<a hidden class="anchor" aria-hidden="true" href="#扩散算法flooding洪泛">#</a></h3>
<p>在扩散法中，每一个入境分组将被路由器转发到除了它进来的那条路线之外的每一条输出线路上。</p>
<p>由于扩散算法会产生大量的重复分组，需要改进扩散算法，避免重复的分组。</p>
<p>收到包就转发</p>
<h3 id="距离矢量路由选择distance-vector-routing">距离矢量路由选择（Distance Vector Routing）<a hidden class="anchor" aria-hidden="true" href="#距离矢量路由选择distance-vector-routing">#</a></h3>
<p>DVR 是一种基于距离的基本路由协议，根据距离确定数据包的最佳路径。它使用简单的度量标准（如跳数）来计算最佳路径，并与邻居共享这些信息。</p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204920532.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p>每个路由器有一个路由表，更新表时只跟邻居交换。</p>
<p>如果结点 i 的所有邻站都知道到结点j的最短距离，那么求结点 i 和结点 j 之间的最短距离就可以用结点 i 到每个邻站之间的距离分别加上该邻站到结点 j 的最短距离，然后再从得数中选择最小的一个。</p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204921101.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p>所有的节点都监听从其他节点传送来的路由选择更新信息，并在下列情况下更新它们的路由选择表：</p>
<p>A. 被通告一条新的路径，该路由在本节点的路由表中部存在，此时本地系统加入这条新的路由；</p>
<p>B. 通过发送来路由信息的节点有一条到达某个目的地的路由，该路由比当前使用的路由有较短的距离（较小的代价）。在这种情况下，就用经过发送路由信息的节点的新路由替换路由表中到达那个目的地的现有路由。</p>
<p>C. 在本节点的现有路由表中为了到达某一目的地首先应前往的下一节点如果通告了一个较高的代价，就要使用这一新的代价更新从本节点前往同一目的地的代价。</p>
<ol>
<li>创建路由表
<ol>
<li><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204921376.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></li>
</ol>
</li>
<li>更新路由表
<ol>
<li><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204922113.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></li>
</ol>
</li>
</ol>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204922693.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p>无穷计算（Count-to-infinity）问题：DVR 在得知更高效或更短路径（好消息）时会快速更新其路由表。然而，对于“坏消息”，如链路故障或更长路径，它的反应较慢。这种差异可能导致“无限计数”问题，其中路由器持续增加失效链路的跳数，导致路由环路和次优路由。</p>
<ul>
<li>好消息传得快，坏消息传得慢，导致了当路由信息发生变化时该变化未能及时地被所有路由器知道，而仍然可能在路由器之间进行传递</li>
<li>慢收敛是导致发生路由回路的根本问题</li>
</ul>
<p>总结</p>
<ol>
<li>使用在 RIP （Routing Information Protocol）、Cisco EIGRP （Enhanced Interior Gateway Routing Protocol）
<ol>
<li>RIP协议为应用层协议，使用UDP传送数据</li>
</ol>
</li>
<li>改进：BGP-4 （Border Gateway Protocol）、IDRP （Inter-domain Routing Protocol）</li>
<li>距离值&gt;=16意味着该网络不可达</li>
</ol>
<h3 id="链路状态路由选择link-state-routing">链路状态路由选择（Link State Routing）<a hidden class="anchor" aria-hidden="true" href="#链路状态路由选择link-state-routing">#</a></h3>
<p>概念</p>
<p>在链路状态路由中，每个路由器都将其邻接网络的信息共享给网络中的所有其他路由器。使用链路状态包（Link-State Packet，LSP）定义并发送最佳已知的网络拓扑。当网络发生变化时，信息会被共享。</p>
<p>步骤</p>
<ol>
<li>发现邻居节点：每个路由器需要发现它的邻居，并知道他们的网络地址。这个过程通常是通过发送一种特殊的数据包，称为 HELLO 包，来实现的。HELLO 包可以在广播网络中广播，也可以在点对点网络中向邻居单播。当邻居收到 HELLO 包后，会回复一个确认包，告诉发送者它是谁。在这里，路由器的标识（Route IDs）必须是全球唯一的。另外，当两个或更多路由器通过局域网或其他多访问网络连接时，可以简化网络拓扑。</li>
<li>测量线路开销：路由器需要测量到每个邻居的延迟或成本。这个过程可以通过测量往返时间（使用 ECHO 包）和带宽来实现。在此过程中，可能需要考虑是否在测量延迟时考虑负载因素，因为这可能会导致路由表振荡，从而引发许多潜在问题。</li>
<li>创建链路状态分组：路由器需要构建一个链路状态分组（Link-State Packet，LSP），该包包含所有新学习到的信息：这个分组的内容包含了发送方的标识，以及是一个序列号（Seq）和年龄（Age），以及一个邻居列表。对于每个邻居，同时也要给出到这个邻居的延迟。这个过程可以定期进行，也可以在一些重大事件发生时进行，例如链路或邻居宕机、重新上线，或其属性发生显著变化。
<ol>
<li>序号是为了解决前面发生的浪费太多资源的问题，每发一包，序号加 1</li>
<li>年龄是为了解决路由器崩溃，序号发生错误等情况，每秒年龄减 1，减到 0 后丢弃</li>
</ol>
</li>
<li>分发链路状态分组：路由器需要将 LSP 可靠地发送到网络中的所有其他路由器，而不仅仅是它的邻居。这个过程主要是通过洪泛法来实现的，以防止路由器之间线路的错误。所有的 LSP 都需要得到确认，以确保其正确送达。</li>
<li>计算新路由：一旦路由器积累了一整套 LSP，它就可以利用这些信息构造出整个网络拓扑图。然后，路由器可以运行 Dijkstra 的算法，根据这个网络拓扑图，计算出本节点到其他结点的最短路径。最后，这些计算结果可以被安装在路由表中，用于指导路由器的路由决策。</li>
</ol>
<p>例子</p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204923268.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p>应用</p>
<p>链路状态路由（Link State Routing）在多种网络协议中得到了采用和实现，主要包括以下两种：</p>
<ol>
<li>IS-IS（Intermediate System to Intermediate System）：这是一个开放性的路由协议，被设计出来主要用于路由交换机（routers）和交换机（switches）之间。IS-IS 协议支持多种网络层协议，如 DECnet，ISO CLNP，IP，AppleTalk，Novell NLSP （IPX）等。这种多协议支持的能力使得它在各种不同的网络环境中都能够工作。</li>
<li>OSPF（Open Shortest Path First）：OSPF 是在 IS-IS 之后设计的一种路由协议，它只为 IP 提供服务。这是一种用于互联网内部网络的路由协议，主要用于在自治系统内部进行路由选择。OSPF 能够动态地适应网络拓扑的改变，其基本思想是让路由器了解到整个网络的拓扑结构，然后用最短路径算法（如 Dijkstra 算法）计算出最佳路由。</li>
</ol>
<p>两者都是基于链路状态的路由选择算法，但他们在具体的应用和支持的网络协议上有所不同。</p>
<h3 id="层次路由hierarchical-routing">层次路由（Hierarchical Routing）<a hidden class="anchor" aria-hidden="true" href="#层次路由hierarchical-routing">#</a></h3>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204923903.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p>红线是原路由，绿线是新路由</p>
<p>Consider a subnet with 720 routers.假设这里有 720 个路由器</p>
<ul>
<li>If there is no hierarchy 不分层
<ul>
<li>720 routing table entries</li>
</ul>
</li>
<li>If the subnet is partitioned into 24 regions of 30 routers each （Total:53） 24 个区域，每个区域 30 个路由器</li>
<li>30 local entries 每个区域本地 30 个表</li>
<li>23 remote entries 其他区域的表</li>
<li>If a three-level hierarchy is chosen, with 8 clusters, each containing 9 regions of 10 routers (Total: 25)
<ul>
<li>10 entries for local routers</li>
<li>8 entries for routing to other regions within its own cluster</li>
<li>7 entries for distant clusters</li>
</ul>
</li>
</ul>
<h3 id="dvr-和-lsr-对比">DVR 和 LSR 对比<a hidden class="anchor" aria-hidden="true" href="#dvr-和-lsr-对比">#</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th></th>
<th>DVR (Distance Vector Routing)</th>
<th>LSR (Link State Routing)</th>
</tr>
</thead>
<tbody>
<tr>
<td>分享的信息</td>
<td>目标网络和距离</td>
<td>网络拓扑（LSP）</td>
</tr>
<tr>
<td>分享对象</td>
<td>相邻路由器</td>
<td>网络中的所有路由器</td>
</tr>
<tr>
<td>分享频率</td>
<td>周期性</td>
<td>变化时</td>
</tr>
<tr>
<td>路由器知道的信息</td>
<td>距离，不包括路径拓扑</td>
<td>整个网络拓扑</td>
</tr>
<tr>
<td>是否有数至无穷的问题</td>
<td>有</td>
<td>没有</td>
</tr>
</tbody>
</table></div>
<h2 id="拥塞控制">拥塞控制<a hidden class="anchor" aria-hidden="true" href="#拥塞控制">#</a></h2>
<p>概念</p>
<p>当一个子网或子网的一部分中出现太多分组的时候，网络的性能开始下降。这种情况称之为拥塞，网络资源上有太多的分组时，将会导致网络性能下降，即对资源需求的总和大于可用资源。</p>
<p>产生拥塞的原因</p>
<p>包括低带宽线路、多个输入对应一个输出、节点缓冲容量小以及节点处理速度低。</p>
<p>任何涉及等待或排队的系统都可能发生拥塞。如果数据包到达率高于数据包处理率，输入队列会变得越来越长。如果数据包离开率低于数据包处理率，输出队列会变得越来越长。</p>
<p>拥塞控制的通用原则</p>
<ul>
<li>开环控制
<ul>
<li>是预防性技术，通过预先采取措施避免拥塞的发生。</li>
<li>确定何时接受新流量、何时丢弃分组及丢弃哪些分组</li>
</ul>
</li>
<li>闭环控制
<ul>
<li>是反应性技术，一旦网络发生拥塞，就采取措施进行应对。</li>
<li>监视系统，检测拥塞发生的时间和地点，将信息传递到能采取行动的地方，然后调整系统运行以解决问题。</li>
</ul>
</li>
</ul>
<p>拥塞控制途径：增加资源和减少负载</p>
<ol>
<li>增加资源：</li>
</ol>
<ul>
<li>网络提供（Network Provisioning）：规划和调整网络，以适应业务负载的需求。通过增加带宽、增加路由器、改进网络拓扑等方式来增加网络资源，以减轻拥塞压力。</li>
<li>业务量感知的路由（Traffic Aware Routing）：在进行路由选择时，考虑网络负载的影响。根据网络拥塞的情况，选择路径以避免拥塞节点或拥塞链路，从而实现负载均衡和拥塞控制。</li>
</ul>
<ol>
<li>减少负载：</li>
</ol>
<ul>
<li>
<p>接纳控制（Admission Control）：仅适用于虚电路网络，当网络资源不足时，拒绝建立新的虚电路连接，以避免进一步加重网络负载。</p>
</li>
<li>
<p>业务量减速（Traffic Throttling）：通过限制流量的速率来降低网络负载。</p>
<ul>
<li>
<p>可以使用抑制分组（choke packet）、逐跳反压（hop-by-hop backpressure）和显示拥塞通知（ECN）等技术来控制和调节流量。</p>
</li>
<li>
<p>choke packet</p>
<ul>
<li>检测拥塞：
<ol>
<li>链路利用率（utilization of the output links）：如果输出链路的利用率过高，那么可能存在网络拥塞的情况。</li>
<li>队列缓冲（buffering of queued packets inside the router）：如果路由器内部的数据包队列缓冲过多，那么可能存在网络拥塞的情况。</li>
<li>丢包数（number of packets that are lost due to insufficient buffering）：如果因为缓冲不足而丢失的数据包数量过多，那么可能存在网络拥塞的情况。 为了估算队列延迟，通常使用指数加权移动均值（Exponentially Weighted Moving Average， EWMA）算法。</li>
</ol>
</li>
<li>通知源主机：
<ol>
<li>发送一个抑制分组（Choke Packet）给源主机，抑制分组中包含了原始数据包中的目标地址。</li>
<li>对原始数据包进行标记，以防止它产生更多的抑制分组。</li>
<li>为了避免增加网络负载，路由器可能会以低速率发送抑制分组。</li>
</ol>
</li>
<li>源主机降速：源主机接收到抑制分组后，可能会根据分组中的信息调整发送到指定目标的数据流量。例如，源主机可能会将流量减少 x%（例如 50%）。这样就可以降低网络拥塞，提高网络的整体性能。</li>
</ul>
</li>
<li>
<p>hop-by-hop backpressure</p>
<ul>
<li>它对经过的每一个跳点（也就是网络中的节点或路由器）都会产生影响。这种机制的主要目的是限制源节点向网络中发送过多的数据，从而减轻网络拥塞。</li>
<li>在逐跳反压机制中，当一个节点（如路由器）检测到网络拥塞时，它会向上游节点发送反压信号，通知上游节点降低发送数据的速率。这个过程会在每个经过的节点间重复，从而使得整个网络路径上的数据流量得到控制。</li>
</ul>
</li>
<li>
<p>ECN（IP/TCP 会使用）</p>
<ul>
<li>
<p>ECN 通过在 IP 数据包头部使用两个比特位来记录数据包是否经历了拥塞。</p>
</li>
<li>
<p>当路由器检测到拥塞时，它会将传输的数据包的 ECN 字段设置为指示拥塞的标记。目的地主机会将这些标记作为明确的拥塞信号回传给发送方，在下一次回复数据包中将标记传递回去。</p>
</li>
</ul>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204924306.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
</li>
</ul>
</li>
<li>
<p>负载掉落（Load Shedding）：当路由器的处理能力不足以处理所有到达的数据包时，可以选择丢弃部分数据包来减轻负载。</p>
<ul>
<li>可以使用不同的策略，如葡萄酒策略（丢新的）或牛奶策略（丢旧的），也可以采用随机早期检测（Random Early Detection/RED）算法，在缓冲区空间即将耗尽之前开始丢弃数据包。</li>
<li>RED：早点丢随机丢
<ul>
<li>RED 的目标是在拥塞出现之前就开始主动丢弃部分数据包，以促使发送方降低传输速率。通过采用随机丢包的方式，RED 可以实现一种分散拥塞的机制，避免了一次性丢弃大量数据包所带来的突发性拥塞。</li>
<li>当某条线路上的平均队列长度超过一个阈值时，该线路被认为是拥塞的，随机丢弃一小部分数据包。</li>
<li>路由器如何向源主机告知拥塞情况呢？路由器直接丢弃选择的数据包，受影响的发送方在没有收到确认时会注意到数据包的丢失。这是一种隐式通知。</li>
<li>源主机在收到丢失的数据包后会减缓其传输速率，以响应丢包情况。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="服务质量">服务质量<a hidden class="anchor" aria-hidden="true" href="#服务质量">#</a></h2>
<ul>
<li>评价标准
<ul>
<li>Reliability
<ul>
<li>Packet error rate 差错率</li>
<li>Packet loss rate 丢包率</li>
</ul>
</li>
<li>Delay</li>
<li>Jitter</li>
<li>Bandwidth</li>
</ul>
</li>
<li>流量整形
<ul>
<li>漏桶（leaky bucket）算法
<ul>
<li><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204924777.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></li>
<li>桶满则数据丢失</li>
<li>每个主机连接到网络的接口中都包含一个漏桶，即含有一个有限长度的内部队列。如果当该队列满的时候，又有一个分组到来，那么该分组将被丢弃，亦即是，如果在一台主机上，队列中的分组数目已经达到了最大值，这是又有一个或者多个进程要发送分组，那么新发送的分组将被丢弃。</li>
</ul>
</li>
<li>令牌桶（token bucket）算法
<ul>
<li><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204925126.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></li>
<li>桶中保存的是令牌，每个令牌包含一定数量的字节的分组，令牌桶允许主机积累发送全，直至到达桶的最大尺寸，因而相对于漏桶，允许有一定的突发流量。</li>
<li>经过令牌桶之后的突发数据持续时间：
<ul>
<li>突发时间S，令牌桶容量B，令牌产生速率R，最大输出速率M</li>
<li>MS=B+RS  &ndash;&gt; S=B(M-R)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>分组调度
<ul>
<li>公平排队（fair queueing）
<ul>
<li>路由器为每一条输出线路使用一组单独的队列，每个流一个队列。当一条线路空闲的时候，路由器轮流扫描这些队列，从下一个队列中取出第一个分组。使得所有的流量以相同的速率发送数据包</li>
<li>（缺陷：他给使用大数据包的主机比使用小数据包的主机提供了更多的带宽）。</li>
</ul>
</li>
<li>加权的公平排队（weighted fair queueing）
<ul>
<li>通过不同的主机赋予不同的优先级进行加权调节，从而提高算法的效率。</li>
<li><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204925683.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></li>
<li></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="网络互联">网络互联<a hidden class="anchor" aria-hidden="true" href="#网络互联">#</a></h2>
<ul>
<li>互联网络的分组转发
<ul>
<li>级联虚电路：
<ul>
<li>优点：
<ul>
<li>路由器预留缓冲区等资源，保证服务质量</li>
<li>分组按序号传输；</li>
<li>分组头短</li>
</ul>
</li>
<li>缺点：
<ul>
<li>路由器需要大量内存，存储虚电路信息；</li>
<li>一旦发生拥塞，没有其它路由；</li>
<li>健壮性差：如果网络中有一个不可靠的数据报子网，级连虚电路很难实现。</li>
</ul>
</li>
</ul>
</li>
<li>无连接网络互联：
<ul>
<li>优点：
<ul>
<li>能够容忍拥塞，并能适应拥塞；</li>
<li>健壮性好；</li>
<li>可用于多种网络互连。</li>
</ul>
</li>
<li>缺点：
<ul>
<li>长包头：</li>
<li>包不能保证按序号到达；</li>
<li>不能保证服务质量。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>隧道技术
<ul>
<li>当源和目标主机位于相同类型的网络中，中间的网络属于不同类型时使用隧道方案。</li>
<li><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204926041.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></li>
</ul>
</li>
<li>互联网路由
<ul>
<li>互联网定义了两级路由算法：在每个网络内部使用的内部网关协议（interior gateway protocol）和在网络之间使用的外部网关协议exterior gateway protocol）。</li>
<li>自治系统（AS,Autonomous System）
<ul>
<li>自治系统：在单一的技术管理下的一组路由器，而这些路由器使用一种AS内部的路由选择协议和共同的度量以确定分组在该AS内的路由，同时还使用一种AS之间的路由选择协议用以确定分组在AS之间的路由。</li>
<li>现在对自治系统AS的定义是强调下面的事实：尽管一个AS使用了多种内部路由选择协议和度量，但重要的是一个AS对其他AS表现出的是一个单一的和一致的路由选择策略。</li>
</ul>
</li>
<li>因特网有两大类路由选择协议
<ul>
<li>内部网关协议IGP（Interior Gateway Protocol）：即在一个自治系统内部使用的路由选择协议。目前这类路由选择协议使用得最多，如RIP和OSPF协议。</li>
<li>外部网关协议EGP（External Gateway Protocol）：若源站和目的站处在不同的自治系统中，当数据报传到一个自治系统的边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中。这样的协议就是外部网关协议EGP。在外部网关协议中目前使用最多的是BGP-4。</li>
</ul>
</li>
</ul>
</li>
<li>分段和重组
<ul>
<li>MTU：Maximum Transmission Unit 最大传输单元</li>
</ul>
</li>
</ul>
<h2 id="internet上的网络层">Internet上的网络层<a hidden class="anchor" aria-hidden="true" href="#internet上的网络层">#</a></h2>
<h3 id="ipv4">IPv4<a hidden class="anchor" aria-hidden="true" href="#ipv4">#</a></h3>
<p>每一台主机和每一个接口的唯一的 32 比特的标识符，点分十进制 x.x.x.x</p>
<h4 id="ipv4-header">IPv4 Header<a hidden class="anchor" aria-hidden="true" href="#ipv4-header">#</a></h4>
<p>一个IP数据报由首部和数据两部分组成。</p>
<p>首部的前一部分是固定长度，共20字节,是所有IP数据报必须具有的。在首部的固定部分的后面是一些可选字段，其长度是可变的。IP分组（数据报）结构如下图所示。IP首部的长度为20-60B。</p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204926463.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<ul>
<li>版本 (version) 字段</li>
</ul>
<p>版本 (Version) 字段记录了数据报属于协议哪个版本。（ipv4 or ipv6）</p>
<ul>
<li>IHL 字段</li>
</ul>
<p>由于头的长度不固定，所以头的 IHL 字段指明了头有多长（以4B为单位）。IHL 的最小值为 5，这表明头没有可选项。该 4 位字段的最大值为 15，把头的长度限制为最大 60 字节，因此选项 (Options) 字段最多为 40 字节。</p>
<ul>
<li>区分服务 (differentiated services) 字段</li>
</ul>
<p>区分服务 (Differentiated services) 字段</p>
<p>该字段最初称为服务类型 (Type of service)。它曾经并且仍然用来区分不同的服务种类。</p>
<p>现在，前 6 位用来标记数据包的服务类别，我们在本章前面描述过的加速服务和确保服务：后 2 位用来携带显式拥塞通知信息，比如数据包是否经历了拥塞，我们在本章的拥塞控制部分描述了显式拥塞通知。</p>
<ul>
<li>总长度 (total length) 字段</li>
</ul>
<p>总长度 (Total length) 字段包含了该数据报中的所有内容，即头和数据。最大长度是 65535 个字节。</p>
<ul>
<li>标识 (identification) 字段</li>
</ul>
<p>标识 (Identification) 字段的用途是让目标主机确定一个新到达的分段属于哪一个数据报。</p>
<p>同一个数据报的所有段包含同样的标识值。</p>
<ul>
<li>DF（Don&rsquo;t Fragment）标志
<ul>
<li>DF=1 不能分段</li>
</ul>
</li>
<li>MF（More Fragments）标志
<ul>
<li>进行分段且后面还有fragment MF=0</li>
<li>后面没有fragment MF=1</li>
</ul>
</li>
<li>分段偏移量 (fragment offset) 字段</li>
</ul>
<p>除了数据报的最后一个段以外，其他所有段的长度必须是 8 字节的倍数(单位为8B)</p>
<h4 id="例ip-数据报分段">例：IP 数据报分段<a hidden class="anchor" aria-hidden="true" href="#例ip-数据报分段">#</a></h4>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204926769.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204927189.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<ul>
<li>生存期 (time to live) 字段</li>
</ul>
<p>生存期 (Time to live) 字段是一个用于限制数据包生存期的计数器。这里的计数单位最初设置为秒，因此最大的生存期为 255 秒。在每一跳上该计数器必须被递减，而且，当数据报在一台路由器上排队时间较长时，该计数器必须多倍递减。实际上，它只是跳计数器，当它递减到 0 时，数据包就被丢弃，并且路由器给数据包的源主机发回一个报警包。</p>
<ul>
<li>协议 (protocol) 字段</li>
</ul>
<p>协议 (Protocol) 字段指明了该将它交给哪个传输进程。</p>
<p>TCP 是6、 UDP 是17</p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204927437.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<ul>
<li>头校验和 (header checksum) 字段</li>
</ul>
<p>头校验和 (Header checksum) 字段。校验算法的执行过程是这样的：当数据到达时，所有的 16 位（半字）累加起来，然后再取结果的补码。该算法的目的是到达数据包的头校验和计算结果应该为 0。这样的校验和对于检测数据包穿过网络时是否发生错误非常有用。请注意，在每一跳必须重新计算头校验和字段，因为至少有个字段总是不断在改变（即生存期字段），</p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204927705.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<ul>
<li>源地址和目标地址</li>
</ul>
<p>源地址 (Source address) 字段和目标地址 (Destination address) 字段表示源网络接和日标网络接口的 P 地址。</p>
<ul>
<li>选项 (options) 字段</li>
</ul>
<p>选项 (Options) 字段的设计意图是提供一种途径，允许后续版本协议包含一些原设计中没有出现的信息，以便实验人员尝试新的想法、避免为那些不常使用的信息分配头字段。</p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204928015.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<h4 id="严格源路由">严格源路由<a hidden class="anchor" aria-hidden="true" href="#严格源路由">#</a></h4>
<p>严格源路由 (Strict source routing) 选项给出了从源到目标的完整路径，其形式是一系列 IP 地址。数据报必须严格地遵循这条路径向前传输。</p>
<h4 id="松散源路由">松散源路由<a hidden class="anchor" aria-hidden="true" href="#松散源路由">#</a></h4>
<p>松散源路由 (Loose source routing) 选项要求该数据包穿越所指定的路由器列表，并且要求按照列表中的顺序前进；但是，在途中也允许经过其他路由器。</p>
<h4 id="记录路由">记录路由<a hidden class="anchor" aria-hidden="true" href="#记录路由">#</a></h4>
<p>记录路由 (Record route) 选项告诉沿途的路由器，将自己的 IP 地址附加到可送字段中。</p>
<h4 id="时间戳">时间戳<a hidden class="anchor" aria-hidden="true" href="#时间戳">#</a></h4>
<p>时间戳 (Timestamp) 选项类似于记录路由选项，只不过每个路由器除了记录自己的 32 位 IP 地址以外，还要记录一个 32 位时间戳</p>
<h4 id="ipv4-地址">IPv4 地址<a hidden class="anchor" aria-hidden="true" href="#ipv4-地址">#</a></h4>
<ol>
<li>分类编址的 ipv4
<ol>
<li><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204928376.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></li>
<li>只有 A/B/C 类地址能分配</li>
<li>主机号全为 0：网络地址</li>
<li>主机号全为 1：广播地址</li>
<li>A：0 8 位网络号</li>
<li>最小网络号为 0，保留不指派</li>
<li>最大网络号为 127，作为本地环回测试，不指派</li>
<li>B：10 16 位网络号</li>
<li>最小网络号也是第一个可指派的网络号 128.0</li>
<li>网络地址为 128.0.0.0</li>
<li>最大网络号也是最后一个可指派的网络号 191.255</li>
<li>网络地址为 191.255.0.0</li>
<li>C：110 24 位网络号</li>
<li>最小网络号也是第一个可指派的网络号 192.0.0</li>
<li>网络地址为 192.0.0.0</li>
<li>最大网络号也是最后一个可指派的网络号 223.255.255</li>
<li>网络地址为 223.255.255.0</li>
</ol>
</li>
<li>划分子网的 ipv4
<ol>
<li>从主机号借用若干位作为子网号</li>
<li><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204928635.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></li>
<li>划分为三个子网后对外仍是一个网络</li>
<li>子网掩码</li>
<li>（IP 地址） AND （子网掩码） = 网络地址</li>
<li>默认子网掩码：未划分子网的情况下使用的子网掩码</li>
<li><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204929259.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></li>
</ol>
</li>
<li>无分类编址的 ipv4
<ol>
<li>CIDR：斜线记法 在斜线后面写上网络号所占的比特数 128.14.34.7/20</li>
<li>路由聚合</li>
<li><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204929716.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></li>
<li>最长前缀匹配：若路由器查表转发分组时，发现有多条路由可选，则选择网络前缀最长的那条</li>
<li>（最小的子网）</li>
</ol>
</li>
</ol>
<h4 id="ipv4-地址的应用规划">IPv4 地址的应用规划<a hidden class="anchor" aria-hidden="true" href="#ipv4-地址的应用规划">#</a></h4>
<p>给定一个 IPv4 地址块，如何将其划分成几个更小的地址块，并将这些地址块分配给互联网中不同网络，进而可以给各网络中的主机和路由器接口分配 IPv4 地址</p>
<ol>
<li>定长的子网掩码 FLSM（Fixed Length Subnet Mask）、
<ol>
<li>使用同一个子网掩码来划分子网</li>
<li>子网划分方式不灵活：只能划分出$$2^$$个子网（是从主机号部分借用的用来作为子网号的比特数量）</li>
<li>每个子网所分配的 1P 地址数量相同，容易造成 P 地址浪费。</li>
</ol>
</li>
</ol>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204930518.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204931390.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<ol>
<li>变长的子网掩码 VLSM（Variable Length Subnet Mask）
<ol>
<li>使用不同的子网掩码来划分子网</li>
<li>子网划分方式灵活：可以按需分配</li>
<li>每个子网所分配的 P 地址数量可以不同，尽可能减少对 P 地址的浪费</li>
</ol>
</li>
</ol>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204932235.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204932858.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<h4 id="nat转换">NAT转换<a hidden class="anchor" aria-hidden="true" href="#nat转换">#</a></h4>
<p>NAT网络地址转换，它是一种把内部私有网络地址(IP地址)翻译成合法网络IP地址的技术。</p>
<p>1)宽带共享解决IP地址匮乏问题</p>
<p>简单地说，NAT就是在局域网内部网络中使用内部地址，而当内部节点要与外部网络进行通讯时，就在网关处，将内部地址替换成公用地址，从而在外部公网(internet)上正常使用，NAT可以使多台计算机共享Internet:连接，只申请一个合法IP地址，就把整个局域网中的计算机接入Internet中。这一功能很好地解决了公共IP地址紧缺的问题。</p>
<p>2)提供安全防护</p>
<p>NAT屏蔽了内部网络，所有内部网计算机对于公共网络来说是不可见的。内部地址（在内部网络中分配给节点的私有IP地址）只能在内部网络中使用，不能被路由转发，隐藏保护了内网的计算机。</p>
<h4 id="ip-数据报分组和转发过程">IP 数据报分组和转发过程<a hidden class="anchor" aria-hidden="true" href="#ip-数据报分组和转发过程">#</a></h4>
<h5 id="直接交付与间接交付">直接交付与间接交付<a hidden class="anchor" aria-hidden="true" href="#直接交付与间接交付">#</a></h5>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204933392.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p>可以通过<strong>目的地址</strong> <strong>IP</strong> 和<strong>源地址的****子网掩码</strong>进行<strong>逻辑与运算</strong>得到<strong>目的网络地址</strong></p>
<p>如果<strong>目的网络地址</strong>和<strong>源网络地址</strong> <strong>相同</strong>，就是<strong>在同一个网络</strong>中，属于<strong>直接交付</strong></p>
<p>如果<strong>目的网络地址</strong>和<strong>源网络地址</strong> <strong>不相同</strong>，就<strong>不在同一个网络</strong>中，属于<strong>间接交付</strong>，传输给主机所在网络的<strong>默认****网关</strong>（路由器），由默认网关帮忙转发。</p>
<h5 id="默认网关">默认网关<a hidden class="anchor" aria-hidden="true" href="#默认网关">#</a></h5>
<p>为了使本网络中的主机能和其他网络中的主机进行通信，给其指定本网络的一个路由器的接口，由该路由器帮忙进行转发。<strong>所指定的路由器</strong>，也被称为<strong>默认****网关</strong></p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204933847.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<h5 id="路由器查表转发过程">路由器查表转发过程<a hidden class="anchor" aria-hidden="true" href="#路由器查表转发过程">#</a></h5>
<ol>
<li>路由器收到 IP 数据报
<ol>
<li>检查 IP 数据报首部是否出错：
<ul>
<li>若出错，则直接丢弃该 IP 数据报并通告源主机</li>
<li>若没有出错，则进行转发</li>
</ul>
</li>
<li>根据 IP 数据报的目的地址在路由表中查找匹配的条目：
<ul>
<li>若找到匹配的条目，则转发给条目中指示的下一跳</li>
<li>若找不到，则丢弃该数据报并通告源主机</li>
</ul>
</li>
</ol>
</li>
<li>假设 IP 数据报首部没有出错，路由器取出 IP 数据报首部各地址字段的值</li>
</ol>
<p>如源地址和目的地址</p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204934384.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<ol>
<li>查表转发</li>
</ol>
<p>逐条检查路由条目，将目的地址与路由条目中的地址掩码进行逻辑与运算得到目的网络地址，然后与路由条目中的目的网络进行比较，如果相同，则这条路由条目就是匹配的路由条目。</p>
<p>按照它的下一条指示，图中所示的也就是接口 1 转发该 IP 数据报</p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204935203.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<h5 id="路由器隔离广播域">路由器隔离广播域<a hidden class="anchor" aria-hidden="true" href="#路由器隔离广播域">#</a></h5>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204935785.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<h3 id="ipv6">IPv6<a hidden class="anchor" aria-hidden="true" href="#ipv6">#</a></h3>
<p>IPv6  地址，冒分十六进制</p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204936056.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p>数据报：</p>
<p><img src="https://picture2023-1309715649.cos.ap-beijing.myqcloud.com/img/%28null%29-20240123204936353.%28null%29"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<h3 id="其他协议">其他协议<a hidden class="anchor" aria-hidden="true" href="#其他协议">#</a></h3>
<h4 id="icmp">ICMP<a hidden class="anchor" aria-hidden="true" href="#icmp">#</a></h4>
<h4 id="arp">ARP<a hidden class="anchor" aria-hidden="true" href="#arp">#</a></h4>
<h4 id="dhcp">DHCP<a hidden class="anchor" aria-hidden="true" href="#dhcp">#</a></h4>

</section>


    <footer class="article-footer">
    

    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.8/katex.min.css"crossorigin="anonymous"
            ><script 
                src="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.8/katex.min.js"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.8/contrib/auto-render.min.js"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
        &copy; 
        
        2024 Bethel<br>共 200.85k 字 · 共 23 篇文章
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        主题 <b><a href="https://stack.jimmycai.com/" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> 由 <a href="https://jimmycai.com/" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script><script type="text/javascript" src="/ts/custom.js" defer></script>


<script src="https://mecdn.mcserverx.com/gh/zhixuan2333/gh-blog/master/js/nprogress.min.js" integrity="sha384-bHDlAEUFxsRI7JfULv3DTpL2IXbbgn4JHQJibgo5iiXSK6Iu8muwqHANhun74Cqg" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://mecdn.mcserverx.com/gh/zhixuan2333/gh-blog/master/css/nprogress.css" integrity="sha384-KJyhr2syt5+4M9Pz5dipCvTrtvOmLk/olWVdfhAp858UCa64Ia5GFpTN7+G4BWpE" crossorigin="anonymous" />
<script>
    NProgress.start();
    document.addEventListener("readystatechange", () => {
        if (document.readyState === "interactive") NProgress.inc(0.8);
        if (document.readyState === "complete") NProgress.done();
    });
</script>
    </body>
</html>
